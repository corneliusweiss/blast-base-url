Blast\BaseUrl
=============

PSR-7 middleware and helpers for working with base URL.
  
Introduction
------------

This package detects base URL of web application. It is useful when you need your app
to be served from subdirectory (like `http://localhost/my-project/public`). This can
be useful sometimes, especially in development environment.

Detection logic is based on [`zend-http`](https://github.com/zendframework/zend-http) 
package.

Usage
-----

For simplicity, following instructions are targeting applications based on 
[Zend Expressive Skeleton](https://github.com/zendframework/zend-expressive-skeleton),
assuming that `Zend\ServiceManager` was selected as DI container.
  
`Blast\BaseUrl` is based on PSR-7, so it will work well with other frameworks/dispatchers
like Slim3 or Relay, just that wiring process will look different.

### Base URL Middleware

Register factory for middleware:

```php
return [
    'dependencies' => [
        // Use 'factories' for services provided by callbacks/factory classes.
        'factories' => [
            Blast\BaseUrl\BaseUrlMiddleware::class => Blast\BaseUrl\BaseUrlMiddlewareFactory::class,
        ],
    ],
];
```

Add `BaseUrlMiddleware` to your pipeline before routing:

```php
return [
    'middleware_pipeline' => [
        'pre_routing' => [
            [
                'middleware' => [
                    BaseUrlMiddleware::class,
                ],
            ],
        ],
    ],
];
```

`BaseUrlMiddleware` will alter path from request URI, stripping base url. It means that
even if you access your project from `http:/localhost/~user/project/public/index.php/foo/bar`,
next middleware in the pipe will see the path as `/foo/bar`.

Additionally, two attributes will be added to ServerRequest, holding base URL and base path:

```php
echo $request->getAttribute(BaseUrlMiddleware::BASE_URL);   
// outputs: /some/subdirectory/index.php

echo $request->getAttribute(BaseUrlMiddleware::BASE_PATH);
// outputs: /some/subdirectory/
```

### Generating URLs

While `BaseUrlMiddleware` fixes the routing process, all URLs generated by your application
will likely point outside the subdirectory. `Blast\BaseUrl` comes with replacement `UrlHelper`,

Here's how to enable it: 

```php
return [
    'dependencies' => [
        'factories' => [
            // setup factory
            Blast\BaseUrl\UrlHelper::class => Blast\BaseUrl\UrlHelperFactory::class,            
        ],
        'aliases' => [
            // alias default UrlHelper with Blast\BaseUrl alternative
            Zend\Expressive\Helper\UrlHelper::class => Blast\BaseUrl\UrlHelper::class,
        ],
    ],
];
```
